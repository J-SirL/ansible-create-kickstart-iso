# Generated by Anaconda 34.25.3.8
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
graphical
repo --name="AppStream" --baseurl=file:///run/install/sources/mount-0000-cdrom/AppStream

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --xlayouts='se'
# System language
lang en_GB.UTF-8

# Network information
network  --bootproto=dhcp --device=enp56s0u2u1i5 --ipv6=auto --activate
network  --hostname=developer.sitedevelopments.lan

# Use CDROM installation media
cdrom

%packages
@^workstation-product-environment
@backup-client
@console-internet
@container-management
@development
@gnome-apps
@graphical-admin-tools
@headless-management
@internet-applications
@office-suite
@remote-desktop-clients
@scientific
@security-tools
@smart-card
@system-tools

%end

# Run the Setup Agent on first boot
firstboot --enable

# System timezone
timezone Europe/Stockholm --utc

#Root password
rootpw --lock
user --groups=wheel --name={{ ks_user }} --password={{ ks_pass }} --iscrypted --gecos="Johan SÃ¶rell"

# Disk Detection and Dynamic Partitioning Scheme
%pre
# Detect the primary disk type
PRIMARY_DISK=$(lsblk -d -o name,rota | awk '$2=="0"{print $1; exit}')

# Determine disk type and create a partition layout file accordingly
if [[ $PRIMARY_DISK == nvme* ]]; then
    # NVMe disk detected
    cat > /tmp/partition_layout << EOF
ignoredisk --only-use=nvme0n1
clearpart --none --initlabel
part /boot --fstype="xfs" --ondisk=nvme0n1 --size=1024
part /boot/efi --fstype="efi" --ondisk=nvme0n1 --size=512
part pv.1050 --fstype="lvmpv" --ondisk=nvme0n1 --grow --size=1 --maxsize=100000
volgroup almalinux_developer --pesize=4096 pv.1050
logvol swap --fstype="swap" --size=16384 --name=swap --vgname=almalinux_developer
logvol /home --fstype="xfs" --percent=30 --name=home --vgname=almalinux_developer
logvol / --fstype="xfs" --percent=29.9 --name=root --vgname=almalinux_developer
logvol /opt --fstype="xfs" --percent=40 --name=opt --vgname=almalinux_developer
EOF
else
    # SATA disk detected
    cat > /tmp/partition_layout << EOF
ignoredisk --only-use=vda
clearpart --none --initlabel
# Define your SATA disk partitioning scheme here
# For example:
part /boot --fstype="xfs" --ondisk=vda --size=1024
part /boot/efi --fstype="efi" --ondisk=vda --size=512
part pv.sata --fstype="lvmpv" --ondisk=vda --grow --size=1 --maxsize=100000
volgroup almalinux_developer --pesize=4096 pv.sata
logvol swap --fstype="swap" --size=16384 --name=swap --vgname=almalinux_developer
logvol /home --fstype="xfs" --percent=30 --name=home --vgname=almalinux_developer
logvol / --fstype="xfs" --percent=29 --name=root --vgname=almalinux_developer
logvol /opt --fstype="xfs" --percent=40 --name=opt --vgname=almalinux_developer
EOF
fi
%end

# Include the dynamic partition layout
%include /tmp/partition_layout